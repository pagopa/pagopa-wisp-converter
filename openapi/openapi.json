{
  "openapi": "3.0.1",
  "info": {
    "termsOfService": "https://www.pagopa.gov.it/",
    "title": "WISP Converter",
    "version": "0.4.25"
  },
  "servers": [
    {
      "url": "http://localhost",
      "description": "Generated server url"
    }
  ],
  "tags": [
    {
      "description": "Application info APIs",
      "name": "Home"
    },
    {
      "description": "Create and Delete payment token timer",
      "name": "ReceiptTimer"
    },
    {
      "description": "ECs and Stations configuration",
      "name": "Configuration"
    },
    {
      "description": "Convert sendPaymentResultV2, closePaymentV2 or paSendRTV2 into paaInviaRT to EC",
      "name": "Receipt"
    },
    {
      "description": "Create and Delete rpt timer",
      "name": "RPTTimer"
    },
    {
      "description": "Conversion and redirection APIs",
      "name": "Redirect"
    },
    {
      "description": "Recovery and reconciliation APIs",
      "name": "Recovery"
    }
  ],
  "paths": {
    "/info": {
      "get": {
        "operationId": "healthCheck",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AppInfoResponse"
                }
              }
            },
            "description": "OK.",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Return OK if application is started",
        "tags": [
          "Home"
        ]
      },
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ]
    },
    "/payments": {
      "get": {
        "operationId": "redirect",
        "parameters": [
          {
            "example": "identificativoIntermediarioPA_sessionId",
            "in": "query",
            "name": "idSession",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "302": {
            "description": "Redirect to Checkout service.",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "tags": [
          "Redirect"
        ]
      },
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ]
    },
    "/receipt": {
      "get": {
        "operationId": "receiptRetrieve",
        "parameters": [
          {
            "in": "query",
            "name": "ci",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "ccp",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "iuv",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "*/*": {
                "schema": {
                  "type": "string"
                }
              }
            },
            "description": "Receipt exists",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "tags": [
          "Receipt"
        ]
      },
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ]
    },
    "/receipt/ko": {
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "operationId": "receiptKo",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "string"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully forwarded negative paaInviaRT to EC",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "tags": [
          "Receipt"
        ]
      }
    },
    "/receipt/ok": {
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "operationId": "receiptOk",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReceiptRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully forwarded positive paaInviaRT to EC",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "tags": [
          "Receipt"
        ]
      }
    },
    "/receipt/timer": {
      "delete": {
        "description": "Delete a timer by paymentToken",
        "operationId": "deleteTimer_1",
        "parameters": [
          {
            "in": "query",
            "name": "paymentTokens",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully paymentToken expiration timer deleted",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "deleteTimer",
        "tags": [
          "ReceiptTimer"
        ]
      },
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Create a timer linked with paymentToken and receipt data",
        "operationId": "createTimer_1",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReceiptTimerRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully paymentToken expiration timer created",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "createTimer",
        "tags": [
          "ReceiptTimer"
        ]
      }
    },
    "/recovery/partitions": {
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Execute reconciliation of all receipts contained in the partitions of the request",
        "operationId": "recoverReceiptToBeReSentByPartition",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RecoveryReceiptByPartitionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/RecoveryReceiptReportResponse"
                }
              }
            },
            "description": "Reconciliation scheduled",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Execute reconciliation for passed receipts by partition.",
        "tags": [
          "Recovery"
        ]
      }
    },
    "/recovery/receipts": {
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Execute reconciliation of all receipts in the request, searching by passed identifier",
        "operationId": "recoverReceiptToBeReSent",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RecoveryReceiptRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/RecoveryReceiptReportResponse"
                }
              }
            },
            "description": "Reconciliation scheduled",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Execute reconciliation for passed receipts.",
        "tags": [
          "Recovery"
        ]
      }
    },
    "/recovery/sessionIds/ok": {
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Execute reconciliation of all receipts related to the sessionIds of the request",
        "operationId": "recoverReceiptToBeReSentBySessionId",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RecoveryReceiptBySessionIdRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/RecoveryReceiptReportResponse"
                }
              }
            },
            "description": "Reconciliation scheduled",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Execute reconciliation for OK receipts by sessionId.",
        "tags": [
          "Recovery"
        ]
      }
    },
    "/recovery/{creditor_institution}/receipt-ko": {
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Execute reconciliation of all IUVs for certain creditor institution, sending RT for close payment.",
        "operationId": "recoverReceiptKOForCreditorInstitution",
        "parameters": [
          {
            "in": "path",
            "name": "creditor_institution",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "dateFrom",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "dateTo",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/RecoveryReceiptResponse"
                }
              }
            },
            "description": "Started reconciling IUVs with explicit RT send",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Execute IUV reconciliation for certain creditor institution.",
        "tags": [
          "Recovery"
        ]
      }
    },
    "/recovery/{creditor_institution}/rpt/{iuv}/receipt-ko": {
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Execute reconciliation of all IUVs for certain creditor institution, sending RT for close payment.",
        "operationId": "recoverReceiptKOForCreditorInstitutionAndIUV",
        "parameters": [
          {
            "in": "path",
            "name": "creditor_institution",
            "required": true,
            "schema": {
              "pattern": "[a-zA-Z0-9_-]{1,100}",
              "type": "string"
            }
          },
          {
            "in": "path",
            "name": "iuv",
            "required": true,
            "schema": {
              "pattern": "[a-zA-Z0-9_-]{1,100}",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "dateFrom",
            "required": true,
            "schema": {
              "pattern": "[a-zA-Z0-9_-]{1,10}",
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "dateTo",
            "required": true,
            "schema": {
              "pattern": "[a-zA-Z0-9_-]{1,10}",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/RecoveryReceiptResponse"
                }
              }
            },
            "description": "Completed IUV reconciliation with explicit RT submission",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/RecoveryReceiptResponse"
                }
              }
            },
            "description": "It is not possible to complete reconciliation (with explicit RT submission) for the submitted UIV",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Execute IUV reconciliation for certain creditor institution.",
        "tags": [
          "Recovery"
        ]
      }
    },
    "/rpt/timer": {
      "delete": {
        "description": "Delete a timer by sessionId",
        "operationId": "deleteTimer",
        "parameters": [
          {
            "in": "query",
            "name": "sessionId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully rpt timer deleted",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "deleteRPTTimer",
        "tags": [
          "RPTTimer"
        ]
      },
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "description": "Create a timer from sessionId data",
        "operationId": "createTimer",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RPTTimerRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successfully rpt timer created",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "createRPTTimer",
        "tags": [
          "RPTTimer"
        ]
      }
    },
    "/whitelist/cis": {
      "get": {
        "operationId": "getCreditorInstitutions",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConfigurationModel"
                }
              }
            },
            "description": "Configuration for EC retrieved.",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "404": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ConfigurationModel"
                }
              }
            },
            "description": "Configuration for EC not found.",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Return the string containing all creditor institutions for the wisp converter logic",
        "tags": [
          "Configuration"
        ]
      },
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "operationId": "createCreditorInstitutionsConfiguration",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConfigurationModel"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK.",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Create the string containing all creditor institutions for the wisp converter logic",
        "tags": [
          "Configuration"
        ]
      }
    },
    "/whitelist/stations": {
      "get": {
        "operationId": "getStations",
        "responses": {
          "200": {
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ConfigurationModel"
                }
              }
            },
            "description": "Configuration for Stations retrieved.",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "404": {
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ConfigurationModel"
                }
              }
            },
            "description": "Configuration for Stations not found.",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Return the string containing all stations for the wisp converter logic",
        "tags": [
          "Configuration"
        ]
      },
      "parameters": [
        {
          "description": "This header identifies the call, if not passed it is self-generated. This ID is returned in the response.",
          "in": "header",
          "name": "X-Request-Id",
          "schema": {
            "type": "string"
          }
        }
      ],
      "post": {
        "operationId": "createStationsConfiguration",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConfigurationModel"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK.",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "headers": {
              "X-Request-Id": {
                "description": "This header identifies the call",
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        },
        "security": [
          {
            "ApiKey": []
          }
        ],
        "summary": "Create the string containing all stations for the wisp converter logic",
        "tags": [
          "Configuration"
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "AppInfoResponse": {
        "type": "object",
        "properties": {
          "environment": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "version": {
            "type": "string"
          }
        }
      },
      "ConfigurationModel": {
        "type": "object",
        "properties": {
          "key": {
            "type": "string"
          }
        }
      },
      "PairStringString": {
        "type": "object",
        "properties": {
          "first": {
            "type": "string"
          },
          "second": {
            "type": "string"
          }
        }
      },
      "RPTTimerRequest": {
        "type": "object",
        "properties": {
          "sessionId": {
            "type": "string"
          }
        }
      },
      "ReceiptRequest": {
        "type": "object",
        "properties": {
          "content": {
            "type": "string"
          }
        }
      },
      "ReceiptTimerRequest": {
        "type": "object",
        "properties": {
          "expirationTime": {
            "type": "integer",
            "format": "int64"
          },
          "fiscalCode": {
            "pattern": "\\w*",
            "type": "string"
          },
          "noticeNumber": {
            "pattern": "\\d*",
            "type": "string"
          },
          "paymentToken": {
            "type": "string"
          },
          "sessionId": {
            "type": "string"
          }
        }
      },
      "RecoveryReceiptByPartitionRequest": {
        "type": "object",
        "properties": {
          "partitionKeys": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "RecoveryReceiptBySessionIdRequest": {
        "type": "object",
        "properties": {
          "sessionIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "RecoveryReceiptPaymentResponse": {
        "type": "object",
        "properties": {
          "ccp": {
            "type": "string"
          },
          "ci": {
            "type": "string"
          },
          "iuv": {
            "type": "string"
          }
        }
      },
      "RecoveryReceiptReportResponse": {
        "type": "object",
        "properties": {
          "receiptStatus": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PairStringString"
            }
          }
        }
      },
      "RecoveryReceiptRequest": {
        "type": "object",
        "properties": {
          "receiptIds": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "RecoveryReceiptResponse": {
        "type": "object",
        "properties": {
          "payments": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RecoveryReceiptPaymentResponse"
            }
          }
        }
      }
    },
    "securitySchemes": {
      "ApiKey": {
        "description": "The API key to access this function app.",
        "in": "header",
        "name": "Ocp-Apim-Subscription-Key",
        "type": "apiKey"
      }
    }
  }
}
